#!/usr/bin/bash
#
# Extract the dependencies for the given target.
#
# Author:   Alastair Hughes
# Contact:  < hobbitalastair at yandex dot com >

source "$(dirname "$0")/../../lib/libmain.sh"
source "$(dirname "$0")/../../lib/libpackage.sh"
source "$(dirname "$0")/../../lib/libtarget.sh"

# We depend on the source tarball and the srcinfo.
printf "srctar/${target}\n"
printf "srcinfo/${target}\n"
printf "path/config\n"

# We also depend on some other packages.
path="${configdir}/src/${target}/PKGBUILD"
exists "${path}" || exit "$?"
# Extract the deps.
deps="$("$(dirname "$0")/../../scripts/lsdeps.sh" \
    <(genmakepkgconf "${configdir}" "${target}") "${path}")" || \
    error 1 "Failed to extract the deps from the PKGBUILD!"
# Turn the deps into actual paths.
pkgpaths="$(printf "%s\n" "${deps}" | \
    findpkgdeps "${configdir}" "${prefix}")" || \
    error "$?" "Failed to find the package dirs!"
printf "%s\n" "${pkgpaths}" | cut -d' ' -f2-
# Special case 'native' packages so that they depend on base and base-devel.
if [ "${prefix}" == "native" ]; then
    printf "targets/base\ntargets/build\n"
fi
