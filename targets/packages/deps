#!/usr/bin/sh
#
# Extract the dependencies for the given target.
#
# Author:   Alastair Hughes
# Contact:  < hobbitalastair at yandex dot com >

configdir="$1"
target="$2"

path="${configdir}/src/${target}/PKGBUILD"

if [ ! -e "${path}" ]; then
    echo "No such target '${target}'!" > /dev/stderr
    exit 1
fi

echo "actions/setup.sh"
sed -n -e 's:  *: :g' -e '/# Depends:/p' < "${path}" | \
    sed -e 's:# Depends\:::' | \
    tr ' ' '\n' | \
    shuf
# TODO: Nondeterminism is useful for testing, but having a flag to turn it off
# would be good.
